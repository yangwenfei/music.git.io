<!--
 * @Author: your name
 * @Date: 2020-06-03 17:37:11
 * @LastEditTime: 2020-06-03 17:37:11
 * @LastEditors: Please set LastEditors
 * @Description: In User Settings Edit
 * @FilePath: \webpack.git.io\2.0版本文档说明.md
--> 
## 说明
生产环境和开发环境的目的不同，生产环境需要localhost server、模块热替换的功能，生产环境则注重体积更小更优化的bundles。所以需要为不同的环境编写彼此独立的webpack配置。将webpack.config.js按环境进行拆分。
参考链接：https://blog.csdn.net/weixin_30448603/article/details/100090842
详细总结webpack配置的链接可以学习：https://juejin.im/post/5ec7e240e51d45788a6d5489


目录结构
- webpack.common.js  //通用功能代码
- webpack.dev.js // 开发环境
- webpack.prod.js // 生产环境

## 需要安装的插件及配置文件内容
###### 需要安装的插件
```
1. npm install webpack-merge --save-dev //合并配置文件内容
2. npm install optimize-css-assets-webpack-plugin@2.3.5 --save-dev //压缩css
3. npm install terser-webpack-plugin --save-dev //压缩js
```
###### 相关代码
- webpack.common.js
```
const path=require('path')
const MiniCssExtractPlugin = require('mini-css-extract-plugin')//将css单独抽离出来，不打包在js中
const HtmlWebpackPlugin = require('html-webpack-plugin');
const CleanWebpackPlugin = require('clean-webpack-plugin')
const webpack = require('webpack');
const VueLoaderPlugin = require('vue-loader/lib/plugin');
module.exports={
  entry:'./src/main.js',//./src/index.js
  output:{
    filename: 'js/[name].[hash:7].js',
    path:path.resolve(__dirname,'dist'),
  },
  stats: {     // 本地起服务或者打包时候，清除过多的日志信息，精简控制台信息。
    modules: false,
    children: false,
    chunks: false,
    chunkModules: false
  },
  module: {
    rules:[
      {
        test:/\.css$/,
        use:[
          "style-loader",
          {
            loader:MiniCssExtractPlugin.loader,
            options:{  //如果不设置这个css的publicPath，背景图和字体文件路径都会有问题
              publicPath:'../'
            }
          },
         "css-loader",'postcss-loader'
        ]
      },
      {
        test:/\.scss$/,
        use:[ "style-loader",
        {
          loader:MiniCssExtractPlugin.loader,
          options:{
            publicPath:'../'
          }
        },
       "css-loader",'postcss-loader']
      },
      {
        test: /\.(png|jpe?g|gif|svg|ico|webp)(\?.*)?$/,
        use:[
          {
            loader: 'url-loader',
            options: {
              limit: 1024 * 8, // 当图片大于8k时，交给file-loader处理，否则url-loader会把图片src转成base64编码
              name: '[name][hash:7].[ext]', //自定义设置输出文件的文件名规则、发布路径
              outputPath: 'images/',
            }
          }
        ]
      },
      {
        test: /\.(woff|woff2|eot|ttf|otf)$/,
        use:[
          {
            loader: 'file-loader',
            options: {
              name: '[name][hash:7].[ext]', //自定义设置输出文件的文件名规则、发布路径
              outputPath: 'fonts/',
            }
          }
        ]
      },
      {
        test: /\.(html|htm)$/,
        use: [
          {
            loader: 'html-withimg-loader',
            options: {
                outputPath: 'images/'
            }
          }
        ]
      },
      {
        test: /\.(js)$/,
        exclude: /(node_modules)/,
        use:[
          {
            loader: 'babel-loader',
            options: {
              plugins: ['@babel/transform-runtime']// 'transform-runtime' 插件告诉 babel 要引用 runtime 来代替注入
            }
          }
        ]
      },
      {
        test: /\.vue$/,
        exclude: /(node_modules)/,
        //'cache-loader':缓存loader编译的结果,'thread-loader' :作用使用 worker 池来运行loader，每个 worker 都是一个 node.js 进程,'vue-loader': 解析.vue文件
        use: ['cache-loader','thread-loader','vue-loader']
      }
      
    ]
  },
  resolve: {
    extensions: ['.vue', '.js','.css', '.scss',  '.json'],// 能够使用户在引入模块时不带扩展名字, 自动解析
    alias: {    //别名，方便快速查找模块
      '@': path.resolve(__dirname, './src')
    }
  },
  plugins: [
    new MiniCssExtractPlugin({
      filename: 'css/[name][hash:7].css',
      // chunkFilename: '[id].css',
    }),
    new CleanWebpackPlugin(['dist']),
    new HtmlWebpackPlugin({
      title: 'Output Management',
      template:'./public/index.html' //template 配置选项可以指定模板位置
    }),
    new webpack.HotModuleReplacementPlugin(),
    new VueLoaderPlugin(),
  ],
}
```
- webpack.dev.js

```
let webpack = require('webpack') 
let merge = require('webpack-merge')     
let base = require('./webpack.common')

module.exports = merge(base, {
  mode: 'development',     // 定义环境变量
  output:{
    publicPath: '/'     //静态资源cdn的地址
  },
  devtool:'inline-source-map',//将编译后的代码映射回原始源代码。如果一个错误来自于 b.js，source map 就会明确的告诉你。方便定位错误所在文件
  devServer: {
    port: 8080,     //设置端口
    hot: true,     // 启用热更新
    open: true,    // 自动打开浏览器
    contentBase: './dist',// 监听目录
    // proxy: {
    //   '/api/*': {
    //     target: 'http://192.168.200.71:8765',
    //     changeOrigin: true
    //   }
    // }
  },
  plugins: [
    new webpack.HotModuleReplacementPlugin(),   //热更新插件
    // new webpack.NamedModulesPlugin(),
    // new webpack.NamedChunksPlugin()    // 使用此插件热更新时控制台会显示模块的相对路径
  ]
})
```
- webpack.prod.js
```
let merge = require('webpack-merge')     
let base = require('./webpack.common')
let TerserPlugin = require('terser-webpack-plugin');        
let OptimizeCssAssetsPlugin = require('optimize-css-assets-webpack-plugin')

module.exports = merge(base, {
  mode: 'production',
  output:{
    publicPath: './'     //静态资源cdn的地址
  },
  optimization: {
    minimize: true,
    minimizer: [
      new TerserPlugin({   // 生产环境压缩JS
        cache: false,    //是否否启用缓存
        parallel: true,   //多通道并行处理
        sourceMap: false, //生产环境关闭源码映射
        terserOptions: {
          warnings: false,    //清除警告
          compress:{
            drop_debugger: true,	// 清除degugger
            drop_console: true   //清除所有的console信息
          }
        }
      }),
      new OptimizeCssAssetsPlugin()   // 生产环境压缩css
    ],
  },
})
```
- package.json
```
{
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1",
    "build": "webpack --config ./webpack.prod.js",
    "dev": "webpack-dev-server --config ./webpack.dev.js"
  },
  "license": "ISC",
  "devDependencies": {
    "@babel/core": "^7.10.1",
    "@babel/plugin-transform-runtime": "^7.10.1",
    "@babel/polyfill": "^7.10.1",
    "@babel/preset-env": "^7.10.1",
    "@babel/preset-stage-0": "^7.8.3",
    "@babel/runtime": "^7.10.1",
    "autoprefixer": "^9.8.0",
    "babel-loader": "^8.1.0",
    "cache-loader": "^4.1.0",
    "clean-webpack-plugin": "^1.0.1",
    "core-js": "^3.6.5",
    "css-loader": "^3.5.3",
    "file-loader": "^6.0.0",
    "html-webpack-plugin": "^4.3.0",
    "html-withimg-loader": "^0.1.16",
    "mini-css-extract-plugin": "^0.9.0",
    "node-sass": "^4.14.1",
    "optimize-css-assets-webpack-plugin": "^5.0.3",
    "postcss": "^7.0.31",
    "postcss-loader": "^3.0.0",
    "sass-loader": "^8.0.2",
    "style-loader": "^1.2.1",
    "terser-webpack-plugin": "^2.3.5",
    "thread-loader": "^2.1.3",
    "url-loader": "^4.1.0",
    "vue-loader": "^15.9.2",
    "vue-template-compiler": "^2.6.11",
    "webpack": "^4.43.0",
    "webpack-cli": "^3.3.11",
    "webpack-dev-server": "^3.11.0",
    "webpack-merge": "^4.2.2"
  },
  "browserslist": [
    "defaults",
    "not ie <= 8",
    "last 2 versions",
    "> 1%",
    "iOS 7",
    "last 3 iOS versions"
  ],
  "dependencies": {
    "vue": "^2.6.11"
  }
}

```
